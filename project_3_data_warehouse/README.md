# Data Warehouse
## Project Overview
- The purpose of this project is to design logs collection database for analysis of music streaming services.
- This project has a song play log table as a fact table and songs, artists, users, and time table as dimension.
- This project is based on AWS (S3, redshift).

## Run Project
1. Write iac.cfg in parent directory. Template is
```
[DWH]
CLUSTER_TYPE=
NODE_TYPE=
NUM_NODES=
DB_NAME=
DB_USER=
DB_PASSWORD=
CLUSTER_IDENTIFIER=
PORT=

[IAM_ROLE]
ARN=
NAME=

[AWS]
KEY=
SECRET=
```

2. Run IaC.py in parent directory.
c option is create IAM and cluster. 
```
python IaC.py c
```

3. Write dwh.cfg. Template is
```
[CLUSTER]
HOST=
DB_NAME=
DB_USER=
DB_PASSWORD=
DB_PORT=

[IAM_ROLE]
ARN=''

[S3]
LOG_DATA='s3://udacity-dend/log_data'
LOG_JSONPATH='s3://udacity-dend/log_json_path.json'
SONG_DATA='s3://udacity-dend/song_data'
```

- You run IaC.py g, get HOST and ARN.

4. Run create_table.py
```
python create_table.py
```

5. Run etl.py.
```
python etl.py
```

6. Delete cluster
```
python IaC.py d
```

## Data in S3
- Song data is subset of [Million Song Dataset](http://millionsongdataset.com/).
- Song data format is
```json
{
    "num_songs": 1, 
    "artist_id": "ARJIE2Y1187B994AB7", 
    "artist_latitude": null, 
    "artist_longitude": null, 
    "artist_location": "", 
    "artist_name": "Line Renaud", 
    "song_id": "SOUPIRU12A6D4FA1E1", 
    "title": "Der Kleine Dompfaff", 
    "duration": 152.92036, 
    "year": 0
}
```

- Log data is generated by [event simulator](https://github.com/Interana/eventsim).
- Log data format is
```json
{
    "artist":null,
    "auth":"Logged In",
    "firstName":"Walter",
    "gender":"M",
    "itemInSession":0,
    "lastName":"Frye",
    "length":null,
    "level":"free",
    "location":"San Francisco-Oakland-Hayward, CA",
    "method":"GET",
    "page":"Home",
    "registration":1540919166796.0,
    "sessionId":38,
    "song":null,
    "status":200,
    "ts":1541105830796,
    "userAgent":"\"Mozilla\/5.0 (Macintosh; Intel Mac OS X 10_9_4) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/36.0.1985.143 Safari\/537.36\"",
    "userId":"39"
}
```

## Schema
- Star schema
- Fact Table
> songplay
- Dimension Table
> user, song, artist, time

### Reference
- [Udacity Data Engineer](https://www.udacity.com/course/data-engineer-nanodegree--nd027)
